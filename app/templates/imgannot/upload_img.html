{% extends "base.html"%}
{% block content %}
<div class="container center_div">
  <div class="row">
    <div class="col-lg">
      <div class="row">
        <h1>Upload New Image</h1></br>
      </div>
      <div class="col-sm">
        <form method=post enctype=multipart/form-data>
          {{ form.hidden_tag() }}
          {{ form.patient_ID }}
          {{ form.patient_nom }}
          {% for error in form.patient_nom.errors %}
          <span style="color: red;">[{{ error }}]</span>
          {% endfor %}

          {{ form.patient_prenom }}
          {% for error in form.patient_prenom.errors %}
          <span style="color: red;">[{{ error }}]</span>
          {% endfor %}

          <h4>Select an image file</h4>
          {{ form.image }}
          <p>
            {% for error in form.image.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
          </p>
          {{ form.submit }}
      </div>
      </form>

    </div>
  </div>

  <h1>Image History</h1>
  <table>
    <thead>
      <td>Image</td>
      <td>Patient ID</td>
      <td>Diagnostic</td>
      <td>Action</td>
    </thead>
    {% for image in image_history %}
    <tr>
      <td>{{ image.image_name }}</td>
      <td>{{ image.patient_id }}</td>
      <td>{{ image.diagnostic }}</td>
      <td><a class="btn btn-success" role="button"
          href="annot?filename={{image.image_name}}&patient_ID={{image.patient_id}}">Resume</a>
        <button type="button" class="btn btn-danger"
          onclick="delete_image('{{image.image_name}}', '{{image.patient_id}}')">Delete</button>
      </td>
    </tr>
    {% endfor %}
  </table>
</div>
<script>

  function delete_image(image_name, patient_id) {
    var dict = {
      "image_name": image_name,
      "patient_id": patient_id,
    };

    var myJSON = JSON.stringify(dict);
    console.log(myJSON)
    $.ajax({
      type: "POST",
      url: "{{url_for('imgannot.delete_image')}}",
      data: myJSON,
      success: function () {
        console.log("Image deleted in Database Successfully");
        location.reload();
      },
      dataType: "text"
    });
  }
</script>

{% endblock %}